"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getOnConflictFields = getOnConflictFields;
exports.getOnConflictReturningFields = getOnConflictReturningFields;
/** @internal */
function getOnConflictFields(meta, data, uniqueFields, options) {
    if (options.onConflictMergeFields) {
        return options.onConflictMergeFields;
    }
    const keys = Object.keys(data).filter(f => {
        return Array.isArray(uniqueFields) && !uniqueFields.includes(f) && !meta?.properties[f]?.embeddable;
    });
    if (options.onConflictExcludeFields) {
        return keys.filter(f => !options.onConflictExcludeFields.includes(f));
    }
    return keys;
}
/** @internal */
function getOnConflictReturningFields(meta, data, uniqueFields, options) {
    if (!meta) {
        return '*';
    }
    const keys = meta.comparableProps.filter(p => !p.lazy && !p.embeddable && Array.isArray(uniqueFields) && !uniqueFields.includes(p.name)).map(p => p.name);
    if (meta.versionProperty) {
        keys.push(meta.versionProperty);
    }
    if (options.onConflictAction === 'ignore') {
        return keys;
    }
    if (options.onConflictMergeFields) {
        return keys.filter(key => !options.onConflictMergeFields.includes(key));
    }
    if (options.onConflictExcludeFields) {
        return [...new Set(keys.concat(...options.onConflictExcludeFields))];
    }
    return keys.filter(key => !(key in data));
}
