"use strict";var O=Object.defineProperty;var u=(e,t)=>O(e,"name",{value:t,configurable:!0});var L=require("node:worker_threads"),g=require("../node-features-roYmp9jK.cjs"),$=require("../register-B3tRrtU1.cjs");require("../get-pipe-path-BoR10qr8.cjs"),require("node:module");var N=require("node:path"),l=require("node:url");require("get-tsconfig");var j=require("node:fs");require("esbuild"),require("node:crypto");var h=require("../index-CoHsQGpm.cjs"),S=require("../client-D6NvIMSC.cjs"),i=require("../register-BujtrvNV.cjs");require("../require-BHfoZkF2.cjs");var D=require("node:fs/promises");require("module"),require("../temporary-directory-B83uKxJF.cjs"),require("node:os"),require("node:net");const m={active:!0},I=u(async e=>{if(!e)throw new Error(`tsx must be loaded with --import instead of --loader
The --loader flag was deprecated in Node v20.6.0 and v18.19.0`);m.namespace=e.namespace,e.tsconfig!==!1&&i.loadTsconfig(e.tsconfig??process.env.TSX_TSCONFIG_PATH),e.port&&(m.port=e.port,e.port.on("message",t=>{t==="deactivate"&&(m.active=!1,e.port.postMessage({type:"deactivated"}))}))},"initialize"),A=u(()=>(i.loadTsconfig(process.env.TSX_TSCONFIG_PATH),"process.setSourceMapsEnabled(true);"),"globalPreload"),w=new Map,b=u(async e=>{if(w.has(e))return w.get(e);if(!await j.promises.access(e).then(()=>!0,()=>!1)){w.set(e,void 0);return}const s=await j.promises.readFile(e,"utf8");try{const o=JSON.parse(s);return w.set(e,o),o}catch{throw new Error(`Error parsing: ${e}`)}},"readPackageJson"),W=u(async e=>{let t=new URL("package.json",e);for(;!t.pathname.endsWith("/node_modules/package.json");){const s=l.fileURLToPath(t),o=await b(s);if(o)return o;const r=t;if(t=new URL("../package.json",t),t.pathname===r.pathname)break}},"findPackageJson"),C=u(async e=>(await W(e))?.type??"commonjs","getPackageType"),Q=u(e=>{[e]=e.split("?");const t=N.extname(e);if(t===".json")return"json";if(t===".mjs"||t===".mts")return"module";if(t===".cjs"||t===".cts")return"commonjs"},"getFormatFromExtension"),G=u(e=>{const t=Q(e);if(t)return t;if(i.tsExtensionsPattern.test(e))return C(e)},"getFormatFromFileUrl"),y="tsx-namespace=",P=u(e=>{const t=e.indexOf(y);if(t===-1)return;const s=e[t-1];if(s!=="?"&&s!=="&")return;const o=t+y.length,r=e.indexOf("&",o);return r===-1?e.slice(o):e.slice(o,r)},"getNamespace"),_=g.isFeatureSupported(g.importAttributes)?"importAttributes":"importAssertions",B=u(async(e,t,s)=>{if(!m.active)return s(e,t);const o=P(e);if(m.namespace&&m.namespace!==o)return s(e,t);if(m.port){const n=new URL(e);n.searchParams.delete("tsx-namespace"),m.port.postMessage({type:"load",url:n.toString()})}S.parent.send&&S.parent.send({type:"dependency",path:e}),i.isJsonPattern.test(e)&&(t[_]||(t[_]={}),t[_].type="json");const r=await s(e,t),c=e.startsWith("file://")?l.fileURLToPath(e):e;if(r.format==="commonjs"&&g.isFeatureSupported(g.esmLoadReadFile)&&r.responseURL?.startsWith("file:")&&!c.endsWith(".cjs")){const n=await D.readFile(new URL(e),"utf8");if(!c.endsWith(".js")||h.isESM(n)){const p=h.transformSync(n,c,{tsconfigRaw:i.fileMatcher?.(c)}),d=o?`${c}?namespace=${encodeURIComponent(o)}`:c;return r.responseURL=`data:text/javascript,${encodeURIComponent(p.code)}?filePath=${encodeURIComponent(d)}`,r}}if(!r.source)return r;const a=r.source.toString();if(r.format==="json"||i.tsExtensionsPattern.test(e)){const n=await h.transform(a,c,{tsconfigRaw:i.fileMatcher?.(c)});return{format:"module",source:i.inlineSourceMap(n)}}if(r.format==="module"){const n=h.transformDynamicImport(c,a);n&&(r.source=i.inlineSourceMap(n))}return r},"load"),T=u(async e=>(!e.format&&e.url.startsWith(i.fileUrlPrefix)&&(e.format=await G(e.url)),e),"resolveMissingFormat"),H=[".js",".json",".ts",".tsx",".jsx"],R=u(async(e,t,s)=>{const[o,r]=e.split("?");let c;for(const a of H)try{return await T(await s(o+a+(r?`?${r}`:""),t))}catch(n){if(c===void 0&&n instanceof Error){const{message:p}=n;n.message=n.message.replace(`${a}'`,"'"),n.stack=n.stack.replace(p,n.message),c=n}}throw c},"tryExtensions"),v=u(async(e,t,s)=>{const o=i.isDirectoryPattern.test(e),r=o?"index":"/index",[c,a]=e.split("?");try{return await R(c+r+(a?`?${a}`:""),t,s)}catch(n){if(!o)try{return await R(e,t,s)}catch{}const p=n,{message:d}=p;throw p.message=p.message.replace(`${r.replace("/",N.sep)}'`,"'"),p.stack=p.stack.replace(d,p.message),p}},"tryDirectory"),k=u(async(e,t,s)=>{const o=i.mapTsExtensions(e);if(o)for(const r of o)try{return await T(await s(r,t))}catch(c){const{code:a}=c;if(a!=="ERR_MODULE_NOT_FOUND"&&a!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw c}},"tryTsPaths"),J=u(async(e,t,s,o)=>{if(!m.active)return s(e,t);const r=t.parentURL&&P(t.parentURL);if(i.requestAcceptsQuery(e)){let a=P(e);if(r&&!a&&(a=r,e+=`${e.includes("?")?"&":"?"}${y}${r}`),m.namespace&&m.namespace!==a)return s(e,t);if(i.isDirectoryPattern.test(e))return await v(e,t,s)}else if(i.tsconfigPathsMatcher&&!t.parentURL?.includes("/node_modules/")){const a=i.tsconfigPathsMatcher(e);for(const n of a)try{return await J(l.pathToFileURL(n).toString(),t,s)}catch{}}if((e.startsWith("#")||!i.isBarePackageName.test(e))&&(i.tsExtensionsPattern.test(t.parentURL)||i.allowJs)){const a=await k(e,t,s);if(a)return a}try{const a=await T(await s(e,t));if(i.requestAcceptsQuery(a.url)){const n=P(a.url);r&&!n&&(a.url+=`${a.url.includes("?")?"&":"?"}${y}${r}`)}return a}catch(a){if(a instanceof Error&&!o){const n=a,{code:p}=n;if(p==="ERR_UNSUPPORTED_DIR_IMPORT")try{return await v(e,t,s)}catch(d){if(d.code!=="ERR_PACKAGE_IMPORT_NOT_DEFINED")throw d}if(p==="ERR_MODULE_NOT_FOUND"){if(n.url){const d=await k(n.url,t,s);if(d)return d}else{const d=a.message.match(/^Cannot find module '([^']+)'/);if(d){const[,E]=d,f=await k(E,t,s);if(f)return f}const U=a.message.match(/^Cannot find package '([^']+)'/);if(U){const[,E]=U,f=l.pathToFileURL(E);f.pathname.endsWith("/package.json")||(f.pathname+="/package.json");const q=await h.readJsonFile(f);if(q?.main){const M=new URL(q.main,f),F=await k(M.toString(),t,s);if(F)return F}}}if(!i.isBarePackageName.test(e))try{return await R(e,t,s)}catch{}}}throw a}},"resolve");g.isFeatureSupported(g.moduleRegister)&&L.isMainThread&&$.register(),exports.globalPreload=A,exports.initialize=I,exports.load=B,exports.resolve=J;
